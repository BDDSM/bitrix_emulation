Процедура ВыполнитьОбновлениеКаталога(ИДСеансаОбмена,Пользователь,МассивИменФайлов) Экспорт
	
	// В общем виде схема такова:
	// 1. Определяем список файлов.
	// 2. Как-то их пытаемся упорядочить, если надо
	// 3. Обрабатываем каждый
	
	
	// кстати, запись "success", возможно, стоит выставлять именно здесь?
	Для Каждого ИмяФайла Из МассивИменФайлов Цикл
		Файл = Новый Файл(ИмяФайла);
		
		Если нрег(Файл.ИмяБезРасширения) = "import"
			И нрег(Файл.Расширение) = ".xml" Тогда
			
			//вот его мы грузить умеем. Сделаем это.
			
			ИмяФайлаПарсера = "c:\pricat\V2\CMLReader\CMLReader.epf";
			ИмяФайлаМенеджераES = "c:\pricat\V2\ES_Manage.epf";
			
			МенеджерЭластика = ВнешниеОбработки.Создать(ИмяФайлаМенеджераES,Ложь);
			Парсер = ВнешниеОбработки.Создать(ИмяФайлаПарсера,Ложь);
			
			Попытка
				МенеджерЭластика.ПоместитьКаталогВЭластик(Файл.ПолноеИмя,Парсер);//разумеется, файла может уже и не быть
			Исключение
				_Ошибка = ОписаниеОшибки();
				ВызватьИсключение(_Ошибка);
			КонецПопытки;	
			
		КонецЕсли;
		
		Запись = РегистрыСведений.СостояниеОбработкиЗагруженныхФайлов.СоздатьМенеджерЗаписи();
		
		Запись.Пользователь		= Пользователь;
		Запись.ИДСеансаОбмена	= ИДСеансаОбмена;
		Запись.ИмяФайла			= Файл.ПолноеИмя;
		
		Запись.Прочитать();
		
		Запись.Состояние	= "success";
		Запись.ДанныеФайла	= Неопределено;//Новый ХранилищеЗначения(Неопределено);//обнуляем
		Запись.Записать();
		
	КонецЦикла;	
	
	
	
	
КонецПроцедуры	